diff --git a/src/h264vaapiencoder.cpp b/src/h264vaapiencoder.cpp
index 2d610de..a0b1df6 100644
--- a/src/h264vaapiencoder.cpp
+++ b/src/h264vaapiencoder.cpp
@@ -144,7 +144,7 @@ bool H264VAAPIEncoder::initialize(const QSize &size)
     // av_dict_set_int(&options, "threads", qMin(16, QThread::idealThreadCount()), 0);
     applyEncodingPreference(options);

-    m_avCodecContext->hw_frames_ctx = av_buffer_ref(m_outputFilter->inputs[0]->hw_frames_ctx);
+    m_avCodecContext->hw_frames_ctx = av_buffersink_get_hw_frames_ctx(m_outputFilter);

     if (int result = avcodec_open2(m_avCodecContext, codec, &options); result < 0) {
         qCWarning(PIPEWIRERECORD_LOGGING) << "Could not open codec" << av_err2str(ret);
